POETRY=poetry

setup:
	$(POETRY) install

# üöÄ ETL (Nova Arquitetura)
etl-news-refactored:
	$(POETRY) run python -m fii_orchestrator.etl.rss_news_refactored

etl-prices-refactored:
	$(POETRY) run python -m fii_orchestrator.etl.b3_prices_refactored

etl-cvm-refactored:
	$(POETRY) run python -m fii_orchestrator.etl.cvm_reports_refactored

etl-pipeline-complete:
	$(POETRY) run python -c "from fii_orchestrator.etl.orchestrators import ETLOrchestrator; ETLOrchestrator().run_complete_etl_pipeline()"

etl-pipeline-funds:
	$(POETRY) run python -c "from fii_orchestrator.etl.orchestrators import ETLOrchestrator; ETLOrchestrator().run_funds_data_collection()"

etl-pipeline-news:
	$(POETRY) run python -c "from fii_orchestrator.etl.orchestrators import ETLOrchestrator; ETLOrchestrator().run_news_collection()"

etl-pipeline-cvm:
	$(POETRY) run python -c "from fii_orchestrator.etl.orchestrators import ETLOrchestrator; ETLOrchestrator().run_cvm_reports_collection()"

# üîç Qualidade e An√°lise
monitor-quality:
	$(POETRY) run python -c "from fii_orchestrator.etl.orchestrators import DataQualityOrchestrator; DataQualityOrchestrator().run_quality_validation()"

quality-validation:
	$(POETRY) run python -c "from fii_orchestrator.etl.orchestrators import DataQualityOrchestrator; DataQualityOrchestrator().run_quality_validation()"

performance-analysis:
	$(POETRY) run python -c "from fii_orchestrator.etl.orchestrators import PerformanceAnalysisOrchestrator; PerformanceAnalysisOrchestrator().run_performance_analysis()"

# üß™ Testes
test:
	$(POETRY) run python -m pytest tests/ -v

test-domain:
	$(POETRY) run python -m pytest tests/test_domain.py -v

test-application:
	$(POETRY) run python -m pytest tests/test_application.py -v

test-coverage:
	$(POETRY) run python -m pytest tests/ --cov=fii_orchestrator --cov-report=html --cov-report=term

# üîß Desenvolvimento
ref-funds:
	$(POETRY) run python -m fii_orchestrator.etl.reference_funds

fmt:
	$(POETRY) run black src/ tests/
	$(POETRY) run ruff check --fix src/ tests/

lint:
	$(POETRY) run ruff check src/ tests/

clean:
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -delete

# üèóÔ∏è Arquitetura
arch-test:
	$(POETRY) run python -c "from fii_orchestrator.infrastructure.config import get_config, get_container; print('‚úÖ Arquitetura funcionando')"

arch-validate:
	$(POETRY) run python -c "from fii_orchestrator.domain.entities import Fund, FundTicker; from fii_orchestrator.application.use_cases import CollectFundDataUseCase; print('‚úÖ Camadas validadas')"

help:
	@echo "Comandos dispon√≠veis:"
	@echo ""
	@echo "üöÄ ETL (Nova Arquitetura):"
	@echo "  etl-news-refactored   - Coletar not√≠cias (refatorado)"
	@echo "  etl-prices-refactored - Coletar pre√ßos (refatorado)"
	@echo "  etl-cvm-refactored    - Coletar CVM (refatorado)"
	@echo "  etl-pipeline-complete - Pipeline completo de ETL"
	@echo "  etl-pipeline-funds    - Coleta apenas de fundos"
	@echo "  etl-pipeline-news     - Coleta apenas de not√≠cias"
	@echo "  etl-pipeline-cvm      - Coleta apenas de CVM"
	@echo ""
	@echo "üîç Qualidade e An√°lise:"
	@echo "  monitor-quality       - Monitorar qualidade dos dados"
	@echo "  quality-validation    - Valida√ß√£o de qualidade"
	@echo "  performance-analysis  - An√°lise de performance"
	@echo ""
	@echo "üß™ Testes:"
	@echo "  test                  - Executar todos os testes"
	@echo "  test-domain           - Testes da camada de dom√≠nio"
	@echo "  test-application      - Testes da camada de aplica√ß√£o"
	@echo "  test-coverage         - Testes com cobertura de c√≥digo"
	@echo ""
	@echo "üîß Desenvolvimento:"
	@echo "  setup                 - Instalar depend√™ncias"
	@echo "  ref-funds             - Gerar refer√™ncia de fundos"
	@echo "  fmt                   - Formatar c√≥digo"
	@echo "  lint                  - Verificar qualidade do c√≥digo"
	@echo "  clean                 - Limpar arquivos tempor√°rios"
	@echo "  arch-test             - Testar arquitetura"
	@echo "  arch-validate         - Validar camadas"
	@echo "  help                  - Mostrar esta ajuda"